<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.9.1"/>
<title>COOLFluiD: Python scripting</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="coolfluid.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">COOLFluiD
   &#160;<span id="projectnumber">Release  kernel</span>
   </div>
   <div id="projectbrief">COOLFluiD is a Collaborative Simulation Environment (CSE) focused on complex MultiPhysics simulations.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.9.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="index.html">COOLFluiD Documentation</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Python scripting </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="introduction"></a>
Introduction</h1>
<p>The python scripting interface provides interaction with the component environment through python scripts, ran either in stand-alone mode or through the GUI. It provides access to the component tree and the signals, options and properties, as well as some explicitely exposed methods from the C++ interface.</p>
<h1><a class="anchor" id="requirements"></a>
Requirements</h1>
<p>Python scripting support requires at least Boost.Python 1.45.1 and Python 2.6.</p>
<h1><a class="anchor" id="example"></a>
An example script</h1>
<p>We dive right in, taking an example from the <a class="el" href="namespacecf3_1_1_u_f_e_m.html">UFEM</a> atests. This script sets up a solver for stready heat conduction, taking the input mesh as an argument from the command line. </p><div class="fragment"><div class="line"><span class="keyword">import</span> sys</div>
<div class="line"><span class="keyword">import</span> <a class="code" href="namespacecoolfluid.html">coolfluid</a> as cf</div>
<div class="line"></div>
<div class="line"><span class="preprocessor"># Global configuration</span></div>
<div class="line">cf.Core.environment().options().configure_option(<span class="stringliteral">&#39;log_level&#39;</span>, 4)</div>
<div class="line"></div>
<div class="line"><span class="preprocessor"># setup a model</span></div>
<div class="line"><a class="code" href="namespaceatest-boussinesq.html#a71f58678b345ddafeef7c59714d69e1a">model</a> = cf.Core.root().create_component(<span class="stringliteral">&#39;HotModel&#39;</span>, <span class="stringliteral">&#39;cf3.solver.CModel&#39;</span>)</div>
<div class="line"><a class="code" href="namespaceatest-boussinesq.html#a71f58678b345ddafeef7c59714d69e1a">model</a>.setup(solver_builder = <span class="stringliteral">&#39;cf3.UFEM.HeatConductionSteady&#39;</span>, physics_builder = <span class="stringliteral">&#39;cf3.physics.DynamicModel&#39;</span>)</div>
<div class="line"><a class="code" href="namespaceatest-boussinesq.html#aa89cd5cb032bfaea5dd7f7944bc9ba95">solver</a> = <a class="code" href="namespaceatest-boussinesq.html#a71f58678b345ddafeef7c59714d69e1a">model</a>.get_child(<span class="stringliteral">&#39;HeatConductionSteady&#39;</span>)</div>
<div class="line"><a class="code" href="namespaceatest-boussinesq.html#a16e666b6c4c21da60e14fcbf7c00bfd5">domain</a> = <a class="code" href="namespaceatest-boussinesq.html#a71f58678b345ddafeef7c59714d69e1a">model</a>.get_child(<span class="stringliteral">&#39;Domain&#39;</span>)</div>
<div class="line"></div>
<div class="line"><span class="preprocessor"># load the mesh (passed as first argument to the script)</span></div>
<div class="line"><a class="code" href="namespaceatest-boussinesq.html#a16e666b6c4c21da60e14fcbf7c00bfd5">domain</a>.load_mesh(file = cf.URI(sys.argv[1]), <a class="code" href="namespacecf3_1_1python.html#a67907f0a2a4e9a684772d2d7b165a5ae">name</a> = <span class="stringliteral">&#39;Mesh&#39;</span>)</div>
<div class="line"></div>
<div class="line"># <a class="code" href="namespaceatest-ufem-navier-stokes-periodic-channel-2d.html#a7d4ef30614c41cbbb476af706979a551">lss</a> setup</div>
<div class="line"><a class="code" href="namespaceatest-ufem-navier-stokes-periodic-channel-2d.html#a7d4ef30614c41cbbb476af706979a551">lss</a> = <a class="code" href="namespaceatest-boussinesq.html#a71f58678b345ddafeef7c59714d69e1a">model</a>.create_component(<span class="stringliteral">&#39;LSS&#39;</span>, <span class="stringliteral">&#39;cf3.math.LSS.System&#39;</span>)</div>
<div class="line"><a class="code" href="namespaceatest-ufem-navier-stokes-periodic-channel-2d.html#a7d4ef30614c41cbbb476af706979a551">lss</a>.options().configure_option(<span class="stringliteral">&#39;solver&#39;</span>, <span class="stringliteral">&#39;Trilinos&#39;</span>);</div>
<div class="line"><a class="code" href="namespaceatest-boussinesq.html#aa89cd5cb032bfaea5dd7f7944bc9ba95">solver</a>.options().configure_option(<span class="stringliteral">&#39;lss&#39;</span>, <a class="code" href="namespaceatest-ufem-navier-stokes-periodic-channel-2d.html#a7d4ef30614c41cbbb476af706979a551">lss</a>)</div>
<div class="line"><a class="code" href="namespaceatest-ufem-navier-stokes-periodic-channel-2d.html#a7d4ef30614c41cbbb476af706979a551">lss</a>.get_child(<span class="stringliteral">&#39;Matrix&#39;</span>).options().configure_option(<span class="stringliteral">&#39;settings_file&#39;</span>, sys.argv[2]);</div>
<div class="line"></div>
<div class="line"><span class="preprocessor"># Boundary conditions</span></div>
<div class="line"><a class="code" href="namespaceatest-boussinesq.html#a505920293eb6d27d3268a15099a043f6">bc</a> = <a class="code" href="namespaceatest-boussinesq.html#aa89cd5cb032bfaea5dd7f7944bc9ba95">solver</a>.get_child(<span class="stringliteral">&#39;BoundaryConditions&#39;</span>)</div>
<div class="line"><a class="code" href="namespaceatest-boussinesq.html#a505920293eb6d27d3268a15099a043f6">bc</a>.add_constant_bc(region_name = <span class="stringliteral">&#39;inner&#39;</span>, variable_name = <span class="stringliteral">&#39;Temperature&#39;</span>).options().configure_option(<span class="stringliteral">&#39;value&#39;</span>, 10)</div>
<div class="line"><a class="code" href="namespaceatest-boussinesq.html#a505920293eb6d27d3268a15099a043f6">bc</a>.add_constant_bc(region_name = <span class="stringliteral">&#39;outer&#39;</span>, variable_name = <span class="stringliteral">&#39;Temperature&#39;</span>).options().configure_option(<span class="stringliteral">&#39;value&#39;</span>, 35)</div>
<div class="line"></div>
<div class="line"><span class="preprocessor"># run the simulation</span></div>
<div class="line"><a class="code" href="namespaceatest-boussinesq.html#a71f58678b345ddafeef7c59714d69e1a">model</a>.simulate()</div>
<div class="line"></div>
<div class="line"><span class="preprocessor"># Write result</span></div>
<div class="line"><span class="preprocessor">domain.write_mesh(cf.URI(&#39;atest-ufem-heat2d-disk.pvtu&#39;))</span></div>
</div><!-- fragment --><p>Let's step through the code. First, the import lines load the necessary modules. We load 'sys' here because we need access to command line arguments. Coolfluid is loaded as cf, to shorten the name and guard against any future changes in module naming. Note that both the coolfluid python library and the <a class="el" href="coolfluid_8py.html">coolfluid.py</a> wrapper script need to be in your PYTHONPATH environment variable. If you are working from a custom build tree, you need to add the dso dir to PYTHONPATH.</p>
<p>Next, the global environment is accessed through cf.Core.environment(), which returns a component. Calling options() returns the list of options, and configure_option is then used here to set the debug level.</p>
<p>A generic solver model is now built directly under root (obtained with <a class="el" href="namespacecoolfluid.html#a58768624e264cd0fc8acc74be708a896">cf.Core.root()</a>) using the cf3.solver.CModel builder. We then call the setup signal, passing builders for the solver and physics. Note that when calling signals with more than one argument, keywords must be provided to distinguish the signal parameters. On-line help can be obtained using 'help model.setup' from the python command line, which will list the valid keywords. Finally, we use the get_child method to obtain the solver and domain for further use.</p>
<p>Next, boundary conditions are added using the BoundaryConditions component that is a child of solver. We chain together a call to the add_constant_bc signal followed with a configuration of the boundary condition value. Each new boundary condition is a component, so values can easily be altered later on.</p>
<p>The last two steps call the signals to run the simulation and write the result to disk.</p>
<h1><a class="anchor" id="implementation_details"></a>
Implementation details</h1>
<p>This section covers some implementation details, mainly useful to component developers who want to expose functionality to python.</p>
<h2><a class="anchor" id="signal_handling"></a>
Signal handling</h2>
<p>Signals are wrapped automatically to member functions in python by querying the component signals at run time. One issue to keep in mind is that when you have a signal that creates a component, very often the user will need access to that component right away, for example to configure an option. The add_constant_bc signal in the example above demonstrates this. So how do we get a signal to return a component?</p>
<p>The answer lies in the creation of a reply to the signal. Signal replies that contain an OptionURI named "created_component" are processed by the coolfluid python library to return the component referred to in the URI. It is the responsability of the component and signal authors to add the required code to the signal function in C++, if so desired. An example of the code that typically needs to be added: </p><div class="fragment"><div class="line">SignalFrame reply = args.create_reply(<a class="code" href="namespacecf3_1_1python.html#acaf7da8b3955bbfbbd067612bd960b85">uri</a>());</div>
<div class="line">SignalOptions reply_options(reply);</div>
<div class="line">reply_options.add_option(<span class="stringliteral">&quot;created_component&quot;</span>, result-&gt;uri());</div>
</div><!-- fragment --><p> Here, 'args' is the SignalArgs parameter for the signal, and 'result' is a handle to the newly created component. </p>
</div></div><!-- contents -->
<hr class="footer"/><address class="footer"><small>
Generated on Sun Jun 14 2015 21:20:18 for COOLFluiD by&nbsp;<a href="http://www.doxygen.org/index.html"><img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.9.1</small></address>
<table width="100%">
  <tr>
    <td>
    </td>
    <td align="right" valign="center">
      Send comments to:<br>
      <a href="mailto:coolfluid@vki.ac.be">COOLFluiD Web Admin</a>
    </td>
  </tr>
</table>
</body>
</html>
